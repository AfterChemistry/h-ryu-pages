<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Frequency–Wavelength–Wavenumber Converter</title>
  <style>
    body{background:#f4f4f4;color:#222;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;line-height:1.6;margin:0}
    a{color:#7b3fc4;text-decoration:none;transition:color .2s}
    a:hover{color:#a76ef8}
    .card{background:#fff;border-radius:1.2em;box-shadow:0 2px 12px rgba(0,0,0,.08);padding:1.4em 2em;margin:1.5em auto;max-width:1200px}
    .tool-container{width:1200px;max-width:98vw;margin:0 auto;display:flex;flex-direction:column;align-items:center}
    .calc-table{width:100%;display:flex;flex-direction:column;align-items:center;margin:1.1em 0}
    .calc-row{display:flex;gap:1.8em;justify-content:center;align-items:center;width:100%}
    .calc-group{display:flex;align-items:center;gap:.2em;min-width:320px;max-width:380px}
    .calc-label{font-size:1em;min-width:110px;padding-right:.3em}
    .calc-input,.calc-select{width:80px;font-size:.97em;padding:.17em .32em;height:2em;border-radius:4px;border:1px solid #bbb}
    .note{font-size:.95em;color:#555}
    .chart-block{width:1200px;max-width:98vw;height:900px;margin:12px auto}
    @media (max-width:1050px){
      .calc-row{flex-direction:column;gap:.7em}
      .calc-group{min-width:160px;max-width:95vw}
      .calc-input,.calc-select{width:90vw;max-width:90vw}
      .chart-block{width:98vw;height:65vw}
    }
  </style>
  <!-- 正常加载 Chart.js；如启用严格 CSP，请允许 cdn.jsdelivr.net -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
</head>
<body>
  <main class="card">
    <h1 style="text-align:center;margin:0">Frequency–Wavelength–Wavenumber Converter</h1>

    <div class="tool-container">
      <form class="calc-table" autocomplete="off" onsubmit="return false;">
        <div class="calc-row">
          <span class="calc-group">
            <label class="calc-label" for="freq">Frequency</label>
            <input type="number" id="freq" step="any" class="calc-input" inputmode="decimal" />
            <select id="freqUnit" class="calc-select">
              <option value="1">Hz</option>
              <option value="1e3">kHz</option>
              <option value="1e6">MHz</option>
              <option value="1e9" selected>GHz</option>
              <option value="1e12">THz</option>
            </select>
          </span>
          <span class="calc-group">
            <label class="calc-label" for="wavelength">Wavelength</label>
            <input type="number" id="wavelength" step="any" class="calc-input" inputmode="decimal" />
            <select id="wlUnit" class="calc-select">
              <option value="1e-6">μm</option>
              <option value="1e-3">mm</option>
              <option value="1e-2">cm</option>
              <option value="1e-9">nm</option>
            </select>
          </span>
          <span class="calc-group">
            <label class="calc-label" for="wavenumber">Wavenumber</label>
            <input type="number" id="wavenumber" step="any" class="calc-input" inputmode="decimal" />
            <select id="wnUnit" class="calc-select">
              <option value="1">cm⁻¹</option>
              <option value="1e3">mm⁻¹</option>
              <option value="1e6">μm⁻¹</option>
            </select>
          </span>
        </div>
      </form>
      <div class="note">
        All values are calculated in vacuum (c = 3 × 10<sup>8</sup> m/s). Enter a value in any field to convert the others.
      </div>
    </div>

    <div class="chart-block"><canvas id="chart" width="1200" height="900"></canvas></div>
  </main>

  <section class="card" style="max-width:1200px">
    <!-- 你的电磁谱说明区块保留即可（纯 HTML/CSS，无脚本依赖） -->
    <!-- …可贴入你之前那段 Radio/Microwave/IR/Visible/UV/X-ray/Gamma 模块… -->
  </section>

  <script>
  document.addEventListener('DOMContentLoaded', function(){
    // 常数与元素句柄
    const c = 3e8;
    const freqInput = document.getElementById("freq");
    const freqUnit  = document.getElementById("freqUnit");
    const wlInput   = document.getElementById("wavelength");
    const wlUnit    = document.getElementById("wlUnit");
    const wnInput   = document.getElementById("wavenumber");
    const wnUnit    = document.getElementById("wnUnit");
    let lock = false;

    function fromFreq(){
      if (lock) return; lock = true;
      const f = parseFloat(freqInput.value) * parseFloat(freqUnit.value);
      if (f > 0){
        const lambda_m = c / f;
        wlInput.value = (lambda_m / parseFloat(wlUnit.value)).toPrecision(8);
        const lambda_cm = lambda_m * 100;
        const wn_cm = 1 / lambda_cm;
        wnInput.value = (wn_cm / parseFloat(wnUnit.value)).toPrecision(8);
      } else { wlInput.value = ''; wnInput.value = ''; }
      lock = false;
    }
    function fromWavelength(){
      if (lock) return; lock = true;
      const lambda_m = parseFloat(wlInput.value) * parseFloat(wlUnit.value);
      if (lambda_m > 0){
        const f = c / lambda_m;
        freqInput.value = (f / parseFloat(freqUnit.value)).toPrecision(8);
        const lambda_cm = lambda_m * 100;
        const wn_cm = 1 / lambda_cm;
        wnInput.value = (wn_cm / parseFloat(wnUnit.value)).toPrecision(8);
      } else { freqInput.value = ''; wnInput.value = ''; }
      lock = false;
    }
    function fromWavenumber(){
      if (lock) return; lock = true;
      const wnval = parseFloat(wnInput.value) * parseFloat(wnUnit.value); // cm⁻¹
      if (wnval > 0){
        const lambda_cm = 1 / wnval;
        const lambda_m = lambda_cm / 100;
        wlInput.value = (lambda_m / parseFloat(wlUnit.value)).toPrecision(8);
        const f = c / lambda_m;
        freqInput.value = (f / parseFloat(freqUnit.value)).toPrecision(8);
      } else { wlInput.value = ''; freqInput.value = ''; }
      lock = false;
    }
    freqInput.addEventListener("input", fromFreq);
    freqUnit.addEventListener("change", fromFreq);
    wlInput.addEventListener("input", fromWavelength);
    wlUnit.addEventListener("change", fromWavelength);
    wnInput.addEventListener("input", fromWavenumber);
    wnUnit.addEventListener("change", fromWavenumber);

    // 图表
    const ctx = document.getElementById('chart').getContext('2d');
    const freqTicks = [0.5,1,2,5,10,20,50,100,200,500,1e3,2e3,5e3,1e4,2e4,5e4,1e5,2e5];
    const freqLabels = freqTicks.map(v => v < 1e3 ? v + 'GHz' : (v/1e3) + 'THz');
    const freqFine = [];
    for (let exp = 9; exp <= 14; exp += 0.007) freqFine.push(Math.pow(10, exp));
    const bandLinesLeft = [{y:1,label:"1 μm"},{y:10,label:"10 μm"},{y:100,label:"100 μm"},{y:1e3,label:"1 mm"},{y:1e4,label:"1 cm"}];
    const bandLinesRight=[{y:1,label:"1 cm⁻¹"},{y:10,label:"10 cm⁻¹"},{y:100,label:"100 cm⁻¹"},{y:1e3,label:"1 mm⁻¹"},{y:1e4,label:"1 μm⁻¹"}];
    const wlUnitChart = { label: "μm",  factor: 1e-6 };
    const wnUnitChart = { label: "cm⁻¹", factor: 1 };

    function drawChart(){
      const wavelengthY = freqFine.map(f => (c / f) / wlUnitChart.factor);
      const wavenumberY = freqFine.map(f => (f / c) / wnUnitChart.factor / 100);
      if (window.myChart) window.myChart.destroy();
      window.myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: freqFine.map(f => f / 1e9),
          datasets: [
            { label:`Wavelength (${wlUnitChart.label})`, data:wavelengthY, yAxisID:'y1', borderWidth:2, fill:false, tension:0.09, pointRadius:0, borderColor:'#d81b60' },
            { label:`Wavenumber (${wnUnitChart.label})`, data:wavenumberY, yAxisID:'y2', borderWidth:2, borderDash:[7,7], fill:false, tension:0.09, pointRadius:0, borderColor:'#212a74' }
          ]
        },
        options: {
          maintainAspectRatio:false, responsive:false, layout:{padding:{right:30}},
          plugins:{ legend:{display:false},
            tooltip:{ mode:'index', intersect:false, titleFont:{size:14}, bodyFont:{size:13},
              callbacks:{ title(items){const v=items[0].parsed.x; return v<1000? v.toFixed(2)+' GHz' : (v/1000).toFixed(2)+' THz'; } }
            }
          },
          scales:{
            x:{ type:'logarithmic', min:0.5, max:2e5, title:{display:true,text:'Frequency (GHz  →  THz)',color:'#212a74',font:{size:16}},
                afterBuildTicks(axis){ axis.ticks = freqTicks.map(v=>({value:v})); return axis.ticks; },
                ticks:{ callback(val){ const i=freqTicks.indexOf(val); return i!==-1? freqLabels[i] : ''; }, autoSkip:true, maxRotation:0, minRotation:0, color:'#212a74', font:{size:13,family:'Arial',weight:'normal'} },
                grid:{color:"#ececec"} },
            y1:{ type:'logarithmic', position:'left', min:Math.min(...wavelengthY)*0.9, max:Math.max(...wavelengthY)*1.1,
                 title:{display:true,text:`Wavelength (${wlUnitChart.label})`,color:'#d81b60',font:{size:15}},
                 grid:{color:"#ececec"},
                 ticks:{ callback(v){ if(v<1||v>=1e4) return Number(v).toExponential(1); if(v>=1e3) return (v/1e3).toFixed(1)+'k'; return Number(v).toFixed(0); },
                        color:"#d81b60", font:{size:13,family:'Arial',weight:'normal'} } },
            y2:{ type:'logarithmic', position:'right', min:Math.min(...wavenumberY)*0.7, max:Math.max(...wavenumberY)*1.3,
                 title:{display:true,text:`Wavenumber (${wnUnitChart.label})`,color:'#212a74',font:{size:15}},
                 grid:{drawOnChartArea:false},
                 ticks:{ callback(v){ if(v<1||v>=1e4) return Number(v).toExponential(1); return Number(v).toFixed(0); },
                        color:"#212a74", font:{size:13,family:'Arial',weight:'normal'} } }
          }
        },
        plugins:[{
          id:'bandLines',
          afterDatasetsDraw(chart){
            const xScale = chart.scales['x'];
            const yScale1 = chart.scales['y1'];
            const yScale2 = chart.scales['y2'];
            const ctx = chart.ctx;
            bandLinesLeft.forEach(line=>{
              const y = yScale1.getPixelForValue(line.y);
              if (y<yScale1.top || y>yScale1.bottom) return;
              ctx.save(); ctx.beginPath(); ctx.setLineDash([4,3]); ctx.strokeStyle="#bbb"; ctx.globalAlpha=.29;
              ctx.moveTo(xScale.left,y); ctx.lineTo(xScale.right,y); ctx.stroke();
              ctx.setLineDash([]); ctx.globalAlpha=1; ctx.font='italic 13px Arial,sans-serif'; ctx.fillStyle="#d81b60"; ctx.textAlign='left';
              ctx.fillText(line.label, xScale.left+5, y-2); ctx.restore();
            });
            bandLinesRight.forEach(line=>{
              const y = yScale2.getPixelForValue(line.y);
              if (y<yScale2.top || y>yScale2.bottom) return;
              ctx.save(); ctx.beginPath(); ctx.setLineDash([4,3]); ctx.strokeStyle="#bbb"; ctx.globalAlpha=.29;
              ctx.moveTo(xScale.left,y); ctx.lineTo(xScale.right,y); ctx.stroke();
              ctx.setLineDash([]); ctx.globalAlpha=1; ctx.font='italic 13px Arial,sans-serif'; ctx.fillStyle="#212a74"; ctx.textAlign='right';
              ctx.fillText(line.label, xScale.right-5, y-2); ctx.restore();
            });
          }
        }]
      });
    }
    drawChart();
  });
  </script>
</body>
</html>
